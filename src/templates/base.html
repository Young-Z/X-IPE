<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Document Viewer{% endblock %}</title>
    
    <!-- xterm.js CSS for FEATURE-005 Interactive Console -->
    <link href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css" rel="stylesheet">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Highlight.js Theme -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" rel="stylesheet">
    <style>
        /* =================================================================
         * ROOT LAYOUT SYSTEM
         * Structure: Top (menu) -> Middle (sidebar + content) -> Bottom (console)
         * All using flexbox with proper height constraints
         * ================================================================= */
        
        :root {
            --top-menu-height: 36px;
            --sidebar-width: 280px;
            --console-collapsed-height: 36px;
            --console-expanded-height: 300px;
            --sidebar-bg: #1e1e2e;
            --sidebar-text: #cdd6f4;
            --sidebar-hover: #313244;
            --sidebar-active: #45475a;
            --content-bg: #ffffff;
            --header-height: 50px;
        }
        
        *, *::before, *::after {
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        
        /* =================================================================
         * ROOT LAYOUT: 3-row vertical stack
         * ================================================================= */
        .page-root {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }
        
        /* ROW 1: Top Menu - fixed height */
        .top-menu {
            flex: 0 0 var(--top-menu-height);
            height: var(--top-menu-height);
            background: #1e1e1e;
            border-bottom: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1rem;
            z-index: 300;
        }
        
        .top-menu .brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #fff;
            text-decoration: none;
        }
        
        .top-menu .brand-name {
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .top-menu .brand-subtitle {
            font-size: 0.65rem;
            color: #888;
            margin-left: 0.5rem;
        }
        
        .top-menu .menu-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .top-menu .menu-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #888;
            text-decoration: none;
            font-size: 0.85rem;
            padding: 0.375rem 0.75rem;
            border-radius: 4px;
            transition: all 0.15s;
        }
        
        .top-menu .menu-link:hover {
            color: #fff;
            background: #333;
        }
        
        .top-menu .menu-link i {
            font-size: 1rem;
        }
        
        /* ROW 2: Middle Section - fills remaining space */
        .middle-section {
            flex: 1 1 auto;
            display: flex;
            flex-direction: row;
            overflow: hidden;
            min-height: 0; /* Critical: allows flex child to shrink */
        }
        
        /* ROW 3: Bottom Console - variable height (handled by terminal.css) */
        /* The terminal-panel is positioned fixed, so middle-section adjusts via JS */
        
        /* =================================================================
         * MIDDLE LEFT: Sidebar
         * ================================================================= */
        .sidebar {
            flex: 0 0 var(--sidebar-width);
            width: var(--sidebar-width);
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0; /* Critical: allows scrolling inside */
        }
        
        .sidebar-header {
            flex: 0 0 auto;
            padding: 1rem;
            border-bottom: 1px solid var(--sidebar-hover);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
        }
        
        .sidebar-header .brand-container {
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header .brand-name {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            color: #fff;
        }
        
        .sidebar-header .brand-subtitle {
            font-size: 0.65rem;
            opacity: 0.7;
            letter-spacing: 0.3px;
        }
        
        .sidebar-header h5 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .sidebar-content {
            flex: 1 1 auto;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 0.5rem 0;
            min-height: 0; /* Critical: allows scrolling */
        }
        
        .sidebar-footer {
            flex: 0 0 auto;
            padding: 0.75rem 1rem;
            border-top: 1px solid var(--sidebar-hover);
        }
        
        .sidebar-footer .settings-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--sidebar-text);
            text-decoration: none;
            font-size: 0.85rem;
            opacity: 0.7;
            transition: opacity 0.15s;
        }
        
        .sidebar-footer .settings-link:hover {
            opacity: 1;
            color: #fff;
        }
        
        .sidebar-footer .settings-link i {
            font-size: 1rem;
        }
        
        /* =================================================================
         * MIDDLE RIGHT: Content Area
         * ================================================================= */
        .content-area {
            flex: 1 1 auto;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-color: var(--content-bg);
            min-width: 0; /* Critical: prevents flex item from overflowing */
            min-height: 0; /* Critical: allows scrolling inside */
        }
        
        .content-header {
            flex: 0 0 var(--header-height);
            height: var(--header-height);
            padding: 0 1rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: #f8f9fa;
        }
        
        .content-header .breadcrumb {
            margin: 0;
            font-size: 0.875rem;
        }
        
        .content-body {
            flex: 1 1 auto;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 1.5rem;
            min-height: 0; /* Critical: allows scrolling */
        }
        
        /* =================================================================
         * SIDEBAR: Tree Navigation
         * ================================================================= */
        .nav-section {
            margin-bottom: 0.25rem;
        }
        
        .nav-section-header {
            display: flex;
            align-items: center;
            padding: 0.5rem 1rem;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.15s;
        }
        
        .nav-section-header:hover {
            background-color: var(--sidebar-hover);
        }
        
        .nav-section-header i {
            margin-right: 0.5rem;
            font-size: 0.9rem;
        }
        
        .nav-section-header .chevron {
            margin-left: auto;
            transition: transform 0.2s;
        }
        
        .nav-section-header.collapsed .chevron {
            transform: rotate(-90deg);
        }
        
        /* Workplace header - special styling */
        .nav-workplace-header {
            background-color: rgba(255, 193, 7, 0.1);
            border-left: 3px solid #ffc107;
        }
        
        .nav-workplace-header:hover {
            background-color: rgba(255, 193, 7, 0.2);
        }
        
        .nav-section-content {
            padding-left: 0.5rem;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.35rem 1rem;
            padding-left: 2rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background-color 0.15s;
            text-decoration: none;
            color: var(--sidebar-text);
        }
        
        .nav-item:hover {
            background-color: var(--sidebar-hover);
            color: var(--sidebar-text);
        }
        
        .nav-item.active {
            background-color: var(--sidebar-active);
        }
        
        .nav-item i {
            margin-right: 0.5rem;
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .nav-folder {
            font-weight: 500;
        }
        
        .nav-folder-content {
            padding-left: 1rem;
        }
        
        /* =================================================================
         * FEATURE-009: File Change Indicator
         * ================================================================= */
        .change-indicator {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: var(--bs-warning, #ffc107);
            border-radius: 50%;
            margin-right: 6px;
            flex-shrink: 0;
            animation: changeIndicatorFadeIn 0.3s ease-in-out;
            box-shadow: 0 0 4px var(--bs-warning, #ffc107);
        }
        
        .nav-item.has-changes {
            display: flex;
            align-items: center;
        }
        
        @keyframes changeIndicatorFadeIn {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .nav-empty {
            padding: 0.5rem 2rem;
            font-size: 0.8rem;
            opacity: 0.6;
            font-style: italic;
        }
        
        /* =================================================================
         * CONTENT: Editor & Placeholder
         * ================================================================= */
        .content-editor-textarea {
            width: 100%;
            height: 100%;
            min-height: 400px;
            font-family: 'SF Mono', Monaco, 'Cascadia Mono', 'Roboto Mono', Consolas, monospace;
            font-size: 14px;
            line-height: 1.6;
            padding: 1rem;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            resize: vertical;
            background-color: #fff;
        }
        
        .content-editor-textarea:focus {
            outline: none;
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
        }
        
        .editor-actions .btn {
            font-size: 0.875rem;
        }
        
        .content-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #6c757d;
        }
        
        .content-placeholder i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }
        
        .loading-spinner {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }
        
        /* =================================================================
         * SCROLLBAR STYLING
         * ================================================================= */
        .sidebar-content::-webkit-scrollbar,
        .content-body::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar-content::-webkit-scrollbar-track,
        .content-body::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .sidebar-content::-webkit-scrollbar-thumb {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        
        .sidebar-content::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .content-body::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 3px;
        }
        
        .content-body::-webkit-scrollbar-thumb:hover {
            background-color: rgba(0, 0, 0, 0.3);
        }
        
        /* =================================================================
         * PROJECT SWITCHER
         * ================================================================= */
        .project-switcher {
            flex: 0 0 auto;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid var(--sidebar-hover);
        }
        
        .project-switcher select {
            width: 100%;
            background-color: var(--sidebar-hover);
            color: var(--sidebar-text);
            border: 1px solid var(--sidebar-active);
            border-radius: 4px;
            padding: 0.375rem 0.5rem;
            font-size: 0.8rem;
        }
        
        /* =================================================================
         * TOAST NOTIFICATIONS
         * ================================================================= */
        .toast-container {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 1050;
        }
        
        .refresh-toast {
            background: linear-gradient(135deg, #28a745, #218838);
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: refreshToastAnim 2.5s ease-in-out forwards;
            margin-bottom: 8px;
        }
        
        .refresh-toast i {
            animation: spin 0.5s ease-in-out;
        }
        
        @keyframes refreshToastAnim {
            0% { opacity: 0; transform: translateX(20px); }
            15% { opacity: 1; transform: translateX(0); }
            85% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(20px); }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* FEATURE-004: Auto-refresh toggle styling */
        .auto-refresh-toggle {
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .auto-refresh-toggle:hover {
            opacity: 1;
        }
        
        .auto-refresh-toggle .form-check-input:checked {
            background-color: #28a745;
            border-color: #28a745;
        }
        
        /* =================================================================
         * WORKPLACE - FEATURE-008
         * ================================================================= */
        .workplace-container {
            display: flex;
            height: 100%;
            width: 100%;
        }
        
        .workplace-sidebar {
            width: 48px;
            min-width: 48px;
            background-color: #f8f9fa;
            border-right: 1px solid #dee2e6;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: width 0.2s ease, min-width 0.2s ease;
        }
        
        .workplace-sidebar:hover,
        .workplace-sidebar.expanded {
            width: 280px;
            min-width: 280px;
        }
        
        .workplace-sidebar-icons {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 0;
            gap: 4px;
        }
        
        .workplace-sidebar-icon {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            color: #6c757d;
            transition: all 0.15s;
            border: none;
            background: none;
        }
        
        .workplace-sidebar-icon:hover {
            background-color: #e9ecef;
            color: #0d6efd;
        }
        
        .workplace-sidebar-icon.active {
            background-color: #0d6efd;
            color: #fff;
        }
        
        .workplace-sidebar-icon i {
            font-size: 1.1rem;
        }
        
        .workplace-sidebar-content {
            display: none;
            flex: 1;
            flex-direction: column;
            overflow: hidden;
        }
        
        .workplace-sidebar:hover .workplace-sidebar-content,
        .workplace-sidebar.expanded .workplace-sidebar-content {
            display: flex;
        }
        
        .workplace-sidebar:hover .workplace-sidebar-icons,
        .workplace-sidebar.expanded .workplace-sidebar-icons {
            display: none;
        }
        
        .workplace-upload-btn {
            margin: 12px;
            flex-shrink: 0;
        }
        
        .workplace-tree {
            flex: 1;
            overflow-y: auto;
            padding: 0 8px 8px;
        }
        
        .workplace-tree-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .workplace-tree-item {
            cursor: pointer;
        }
        
        .workplace-tree-item-content {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 8px;
            border-radius: 4px;
            font-size: 0.85rem;
            transition: background-color 0.15s;
        }
        
        .workplace-tree-item-content:hover {
            background-color: #e9ecef;
        }
        
        .workplace-tree-item-content i {
            color: #6c757d;
            flex-shrink: 0;
        }
        
        .workplace-tree-item.has-children > ul {
            display: none;
        }
        
        .workplace-tree-item.has-children.expanded > ul {
            display: block;
        }
        
        .workplace-tree-item.has-children > .workplace-tree-item-content::before {
            content: '\F229';
            font-family: 'bootstrap-icons';
            font-size: 0.7rem;
            margin-right: 2px;
            transition: transform 0.15s;
        }
        
        .workplace-tree-item.has-children.expanded > .workplace-tree-item-content::before {
            transform: rotate(90deg);
        }
        
        .workplace-tree-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
        }
        
        .workplace-tree-actions {
            display: none;
            align-items: center;
            gap: 2px;
            margin-left: auto;
        }
        
        .workplace-tree-item-content:hover .workplace-tree-actions {
            display: flex;
        }
        
        .workplace-tree-action-btn {
            background: none;
            border: none;
            padding: 2px 5px;
            cursor: pointer;
            opacity: 0.6;
            font-size: 0.75rem;
            border-radius: 3px;
            transition: all 0.15s;
        }
        
        .workplace-tree-action-btn:hover {
            opacity: 1;
        }
        
        .workplace-tree-download-btn {
            color: #0d6efd;
        }
        
        .workplace-tree-download-btn:hover {
            background-color: rgba(13, 110, 253, 0.1);
        }
        
        .workplace-tree-delete-btn {
            color: #dc3545;
        }
        
        .workplace-tree-delete-btn:hover {
            background-color: rgba(220, 53, 69, 0.1);
        }
        
        .workplace-rename-input {
            border: 1px solid #007bff;
            border-radius: 3px;
            padding: 2px 6px;
            font-size: 0.85rem;
            width: 100%;
            outline: none;
        }
        
        .workplace-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background-color: #fff;
        }
        
        .workplace-placeholder,
        .workplace-empty,
        .workplace-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #6c757d;
            text-align: center;
            padding: 2rem;
        }
        
        .workplace-placeholder i,
        .workplace-empty i,
        .workplace-error i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .workplace-error i {
            color: #dc3545;
        }
        
        /* Workplace Editor */
        .workplace-editor {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .workplace-editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            flex-shrink: 0;
        }
        
        .workplace-editor-path {
            font-size: 0.85rem;
            color: #6c757d;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .workplace-editor-status {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .workplace-editor-status i.spin {
            animation: spin 1s linear infinite;
        }
        
        .workplace-editor-textarea {
            flex: 1;
            width: 100%;
            border: none;
            padding: 12px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            resize: none;
            outline: none;
        }
        
        .workplace-editor-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }
        
        /* Workplace Editor Actions */
        .workplace-editor-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .workplace-cancel-btn {
            font-size: 0.8rem;
            padding: 4px 12px;
        }
        
        /* Edit hint for double-click */
        .workplace-edit-hint-container {
            padding: 4px 16px 8px;
            text-align: center;
            border-top: 1px solid #f0f0f0;
            background: #fafafa;
        }
        
        .workplace-edit-hint {
            font-size: 0.75rem;
            opacity: 0.7;
        }
        
        .workplace-content-body[title]:not([title=""]) {
            cursor: pointer;
        }
        
        /* Workplace Content Body (view mode) */
        .workplace-content-body {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }
        
        .workplace-markdown-content {
            max-width: 900px;
        }
        
        .workplace-code-content {
            margin: 0;
            padding: 16px;
            background-color: #f6f8fa;
            border-radius: 6px;
            overflow-x: auto;
        }
        
        .workplace-code-content code {
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .workplace-text-content {
            margin: 0;
            padding: 16px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        /* Workplace Binary Placeholder */
        .workplace-binary-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            min-height: 300px;
            text-align: center;
            color: #6c757d;
        }
        
        .workplace-binary-placeholder i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        .workplace-binary-placeholder h5 {
            margin-bottom: 0.5rem;
            color: #495057;
        }
        
        /* Workplace Uploader */
        .workplace-uploader {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 1rem;
        }
        
        /* Workplace Tabs */
        .workplace-tabs {
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 1rem;
        }
        
        .workplace-tabs .nav-link {
            color: #6c757d;
            border: none;
            padding: 0.75rem 1.25rem;
        }
        
        .workplace-tabs .nav-link:hover {
            border: none;
            color: #007bff;
        }
        
        .workplace-tabs .nav-link.active {
            color: #007bff;
            border: none;
            border-bottom: 2px solid #007bff;
            background: none;
        }
        
        .workplace-tab-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .workplace-tab-content .tab-pane {
            flex: 1;
            display: none;
            flex-direction: column;
        }
        
        .workplace-tab-content .tab-pane.active {
            display: flex;
        }
        
        /* Compose Area */
        .workplace-compose {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .workplace-compose-textarea {
            flex: 1;
            min-height: 300px;
            width: 100%;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1rem;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 1rem;
            line-height: 1.6;
            resize: none;
            outline: none;
        }
        
        .workplace-compose-textarea:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.15);
        }
        
        .workplace-compose-textarea::placeholder {
            color: #adb5bd;
        }
        
        .workplace-compose-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }
        
        /* Upload Tab Pane */
        #upload-pane {
            align-items: center;
            justify-content: center;
            padding-top: 2rem;
        }
        
        .workplace-dropzone {
            width: 100%;
            max-width: 500px;
            padding: 3rem 2rem;
            border: 2px dashed #adb5bd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .workplace-dropzone:hover,
        .workplace-dropzone.dragover {
            border-color: #007bff;
            background-color: #f0f7ff;
        }
        
        .workplace-dropzone i {
            font-size: 3rem;
            color: #6c757d;
            margin-bottom: 1rem;
        }
        
        .workplace-dropzone.dragover i {
            color: #007bff;
        }
        
        .workplace-dropzone.uploading {
            pointer-events: none;
            opacity: 0.6;
        }
        
        .workplace-upload-status {
            margin-top: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            color: #6c757d;
        }
        
        .workplace-supported-formats {
            width: 100%;
            max-width: 500px;
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }
        
        .format-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }
        
        .format-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        
        .format-tag-docs {
            background-color: #d4edda;
            color: #155724;
        }
        
        .format-tag-data {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .format-tag-code {
            background-color: #cce5ff;
            color: #004085;
        }
        
        /* Markdown Body Styles - FEATURE-002 */
        .markdown-body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            font-size: 16px;
            line-height: 1.6;
            word-wrap: break-word;
        }
        
        .markdown-body h1, .markdown-body h2, .markdown-body h3,
        .markdown-body h4, .markdown-body h5, .markdown-body h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }
        
        .markdown-body h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        .markdown-body h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
        .markdown-body h3 { font-size: 1.25em; }
        .markdown-body h4 { font-size: 1em; }
        .markdown-body h5 { font-size: 0.875em; }
        .markdown-body h6 { font-size: 0.85em; color: #6a737d; }
        
        .markdown-body p { margin-top: 0; margin-bottom: 16px; }
        
        .markdown-body code {
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(27, 31, 35, 0.05);
            border-radius: 6px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
        }
        
        .markdown-body pre {
            padding: 16px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: #f6f8fa;
            border-radius: 6px;
        }
        
        .markdown-body pre code {
            padding: 0;
            margin: 0;
            font-size: 100%;
            background-color: transparent;
            border-radius: 0;
        }
        
        .markdown-body blockquote {
            padding: 0 1em;
            color: #6a737d;
            border-left: 0.25em solid #dfe2e5;
            margin: 0 0 16px 0;
        }
        
        .markdown-body ul, .markdown-body ol {
            padding-left: 2em;
            margin-top: 0;
            margin-bottom: 16px;
        }
        
        .markdown-body li + li { margin-top: 0.25em; }
        
        .markdown-body table {
            border-spacing: 0;
            border-collapse: collapse;
            margin-bottom: 16px;
            width: 100%;
        }
        
        .markdown-body table th, .markdown-body table td {
            padding: 6px 13px;
            border: 1px solid #dfe2e5;
        }
        
        .markdown-body table th { font-weight: 600; background-color: #f6f8fa; }
        .markdown-body table tr:nth-child(2n) { background-color: #f6f8fa; }
        
        .markdown-body hr {
            height: 0.25em;
            padding: 0;
            margin: 24px 0;
            background-color: #e1e4e8;
            border: 0;
        }
        
        .markdown-body a { color: #0366d6; text-decoration: none; }
        .markdown-body a:hover { text-decoration: underline; }
        
        .markdown-body img { max-width: 100%; box-sizing: border-box; }
        
        /* Mermaid diagrams */
        .mermaid { text-align: center; margin: 16px 0; }
        
        /* Code viewer (non-markdown) */
        .code-viewer {
            background-color: #f6f8fa;
            border-radius: 6px;
            padding: 16px;
            overflow: auto;
        }
        
        .code-viewer pre {
            margin: 0;
            padding: 0;
            background: transparent;
        }
        
        /* Loading state */
        .content-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
        }
    </style>
    
    <!-- FEATURE-005: Terminal Panel CSS -->
    <link href="/static/css/terminal.css" rel="stylesheet">
    
    {% block extra_css %}{% endblock %}
</head>
<body>
    {% block body %}{% endblock %}
    
    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <!-- Highlight.js for syntax highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- Mermaid.js for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <!-- AntV Infographic for infographic DSL diagrams -->
    <script src="https://unpkg.com/@antv/infographic@latest/dist/infographic.min.js"></script>
    <!-- Socket.IO for WebSocket communication -->
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4/dist/socket.io.min.js"></script>
    <!-- xterm.js for FEATURE-005 Interactive Console -->
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-unicode11@0.6.0/lib/xterm-addon-unicode11.js"></script>
    <!-- FEATURE-005: Terminal Manager -->
    <script src="/static/js/terminal.js"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>