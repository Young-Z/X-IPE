(()=>{if(win dow.__xipeToolbarInjected)return;win dow.__xipeToolbarInjected=true;win dow.__xipeRefData={mode:'theme',colors:[],components:[],design_tokens:null};win dow.__xipeRefReady=false;win dow.__xipeRefCommand=null;const modeRegistry ={};const modeContain ers={};let activeMode='theme';win dow.__xipeRegisterMode=(name,in itFn)=>{modeRegistry [name]=in itFn;const contain er=modeContain ers[name];if(contain er&&name===activeMode){in itFn(contain er);}};let toastContain er;win dow.__xipeToast=(msg,type='in fo',dur=4000)=>{if(!toastContain er)return;const toast=document.createElement('div');toast.class Name=`xipe-toast xipe-toast-${type}`;const icons={in fo:'‚Ñπ',progress:'‚è≥',success:'‚úì',error:'‚úó'};toast.in nerHTML=`<span class ="xipe-toast-icon">${icons[type]||'‚Ñπ'}</span><span class ="xipe-toast-msg">${msg}</span>`;toastContain er.appendChild(toast);while(toastContain er.children.length>3){toastContain er.removeChild(toastContain er.firstChild);}if(type!=='error'){setTimeout(()=>{if(toast.parentNode)toast.remove();},dur);}else{const dismiss=document.createElement('button');dismiss.class Name='xipe-toast-dismiss';dismiss.textContent='√ó';dismiss.onclick=()=>toast.remove();toast.appendChild(dismiss);}};const style=document.createElement('style');style.textContent=`
.xipe-toolbar{position:fixed;top:50%;right:20px;z-in dex:2147483647;font-family:'Outfit',system-ui,sans-serif;user-select:none;transfor m:translateY(-50%);}.xipe-hamburger{width:52px;height:52px;background:lin ear-gradient(135deg,#3730a3,#4f46e5);border:2px solid rgba(255,255,255,0.25);border-radius:50%;display:flex;align-items:center;justif y-content:center;cursor:grab;color:white;font-size:9px;font-weight:700;let ter-spacin g:0.08em;box-shadow:0 4px 16px rgba(55,48,163,0.35);transition:all 0.4s cubic-bezier(0.22,1,0.36,1);}.xipe-hamburger:hover{background:lin ear-gradient(135deg,#4f46e5,#7c3aed,#a855f7);transfor m:scale(1.1);}.xipe-panel{position:absolute;right:62px;top:50%;transfor m:translateY(-50%);width:280px;max-height:80vh;background:#0f172a;border:1px solid rgba(255,255,255,0.1);border-radius:16px;overflow:hidden;transition:width 350ms cubic-bezier(0.22,1,0.36,1),opacity 350ms;box-shadow:0 8px 32px rgba(0,0,0,0.4);}.xipe-panel.xipe-collapsed{width:0;opacity:0;poin ter-events:none;overflow:hidden;border:none;}.xipe-panel-header{paddin g:14px 16px 10px;border-bottom:1px solid rgba(255,255,255,0.08);display:flex;align-items:center;gap:8px;}.xipe-panel-title{color:#e2e8f0;font-size:13px;font-weight:600;}.xipe-status-dot{width:6px;height:6px;border-radius:50%;background:#10b981;}.xipe-mode-tabs{display:flex;gap:4px;paddin g:8px 12px;}.xipe-mode-tab{flex:1;paddin g:6px 8px;background:transparent;border:1px solid rgba(255,255,255,0.12);border-radius:8px;color:#94a3b8;font-size:11px;font-weight:500;cursor:poin ter;text-align:center;transition:all 0.2s;font-family:in herit;}.xipe-mode-tab.xipe-active{background:#10b981;color:white;border-color:#10b981;}.xipe-mode-content{paddin g:12px;overflow-y:auto;max-height:calc(80vh-120px);min -height:100px;}.xipe-toast-area{paddin g:8px 12px;}.xipe-toast{display:flex;align-items:center;gap:6px;paddin g:8px 12px;border-radius:8px;font-size:11px;color:#e2e8f0;margin -bottom:4px;animation:xipe-slide-in 0.3s ease;}.xipe-toast-in fo{background:rgba(59,130,246,0.15);border:1px solid rgba(59,130,246,0.3);}.xipe-toast-progress{background:rgba(168,85,247,0.15);border:1px solid rgba(168,85,247,0.3);}.xipe-toast-success{background:rgba(16,185,129,0.15);border:1px solid rgba(16,185,129,0.3);}.xipe-toast-error{background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);}.xipe-toast-icon{font-size:14px;}.xipe-toast-msg{flex:1;}.xipe-toast-dismiss{background:none;border:none;color:#94a3b8;cursor:poin ter;font-size:14px;paddin g:0 4px;font-family:in herit;}@keyframes xipe-slide-in{from{transfor m:translateX(20px);opacity:0;}to{transfor m:translateX(0);opacity:1;}}`;document.head.appendChild(style);const toolbar=document.createElement('div');toolbar.class Name='xipe-toolbar';const hamburger=document.createElement('div');hamburger.class Name='xipe-hamburger';hamburger.textContent='X-IPE';toolbar.appendChild(hamburger);const panel=document.createElement('div');panel.class Name='xipe-panel xipe-collapsed';const header=document.createElement('div');header.class Name='xipe-panel-header';header.in nerHTML='<span class ="xipe-status-dot"></span><span class ="xipe-panel-title">X-IPE Reference</span>';panel.appendChild(header);const tabsDiv=document.createElement('div');tabsDiv.class Name='xipe-mode-tabs';const modes=[{id:'theme',label:'üé® Catch Theme'},{id:'mockup',label:'üìê Copy Mockup'}];const tabEls=modes.map(m=>{const btn=document.createElement('button');btn.class Name=`xipe-mode-tab${m.id===activeMode ? ' xipe-active':''}`;btn.dataset.mode=m.id;btn.textContent=m.label;btn.onclick=()=>switch Mode(m.id);tabsDiv.appendChild(btn);return btn;});panel.appendChild(tabsDiv);const contentArea=document.createElement('div');contentArea.class Name='xipe-mode-content';modes.for Each(m=>{const contain er=document.createElement('div');contain er.class Name=`xipe-mode-${m.id}`;contain er.style.display=m.id===activeMode ? 'block':'none';modeContain ers[m.id]=contain er;contentArea.appendChild(contain er);});panel.appendChild(contentArea);toastContain er=document.createElement('div');toastContain er.class Name='xipe-toast-area';panel.appendChild(toastContain er);toolbar.appendChild(panel);document.body.appendChild(toolbar);function switch Mode(mode){activeMode=mode;win dow.__xipeRefData.mode=mode;tabEls.for Each(t=>t.class List.toggle('xipe-active',t.dataset.mode===mode));Object.entries(modeContain ers).for Each(([name,el])=>{el.style.display=name===mode ? 'block':'none';});if(modeRegistry [mode]&&!modeContain ers[mode].dataset.in itialized){modeRegistry [mode](modeContain ers[mode]);modeContain ers[mode].dataset.in itialized='true';}}let collapseTimer=null;function expandPanel(){panel.class List.remove('xipe-collapsed');}function collapsePanel(){panel.class List.add('xipe-collapsed');}hamburger.addEventListener('mouseenter',()=>{clearTimeout(collapseTimer);expandPanel();});panel.addEventListener('mouseenter',()=>{clearTimeout(collapseTimer);});panel.addEventListener('mouseleave',()=>{collapseTimer=setTimeout(collapsePanel,2000);});hamburger.addEventListener('mouseleave',()=>{collapseTimer=setTimeout(collapsePanel,2000);});let isDraggin g=false;let dragOffsetX=0,dragOffsetY=0;hamburger.addEventListener('mousedown',(e)=>{isDraggin g=true;dragOffsetX=e.clientX-toolbar.getBoundin gClientRect().left;dragOffsetY=e.clientY-toolbar.getBoundin gClientRect().top;hamburger.style.cursor='grabbin g';e.preventDefault();});document.addEventListener('mousemove',(e)=>{if(!isDraggin g)return;let x=e.clientX-dragOffsetX;let y=e.clientY-dragOffsetY;x=Math.max(10,Math.min(win dow.in nerWidth-62,x));y=Math.max(10,Math.min(win dow.in nerHeight-62,y));toolbar.style.left=x+'px';toolbar.style.top=y+'px';toolbar.style.right='auto';toolbar.style.transfor m='none';});document.addEventListener('mouseup',()=>{if(isDraggin g){isDraggin g=false;hamburger.style.cursor='grab';}});win dow.__xipeGenerateSelector=function(el){if(!el||el===document.body||el===document.documentElement)return 'body';if(el.id)return '#'+CSS.escape(el.id);const parts=[];let current=el;while(current&&current!==document.body&&current!==document.documentElement){let part=current.tagName.toLowerCase();const stableClasses=[...current.class List].filter(c=>!/[0-9a-f]{6,}|__|--[a-z0-9]{4,}/i.test(c)).filter(c=>!c.startsWith('xipe-')).slice(0,2);if(stableClasses.length){part+='.'+stableClasses.map(CSS.escape).join('.');}else{const siblin gs=[...(current.parentElement?.children||[])].filter(c=>c.tagName===current.tagName);const idx=siblin gs.in dexOf(current);if(siblin gs.length>1)part+=`:nth-of -type(${idx+1})`;}parts.unshif t(part);current=current.parentElement;}return 'body>'+parts.join('>');};function handleDeepCapture(targetId){const comp=win dow.__xipeRefData.components.fin d(c=>c.id===targetId);if(!comp){win dow.__xipeToast(`Component ${targetId}not found`,'error');return;}const el=document.querySelector(comp.selector);if(!el){win dow.__xipeToast(`Element not found for ${targetId}`,'error');return;}const styles=win dow.getComputedStyle(el);const allStyles={};for(let i=0;i<styles.length;i++){allStyles[styles[i]]=styles.getPropertyValue(styles[i]);}comp.html_css={level:'deep',computed_styles:allStyles,outer_html:el.outerHTML};win dow.__xipeToast(`Deep capture complet e:${targetId}`,'success');win dow.__xipeRefReady=true;}function pollCommands(){const cmd=win dow.__xipeRefCommand;if(!cmd)return;win dow.__xipeRefCommand=null;try{switch(cmd.action){case 'deep_capture':handleDeepCapture(cmd.target);break;case 'reset':win dow.__xipeRefData={mode:activeMode,colors:[],components:[],design_tokens:null};win dow.__xipeToast('Data reset','in fo');break;default :win dow.__xipeToast(`Unknown command:${cmd.action}`,'error');}}catch(e){win dow.__xipeToast(`Command error:${e.message}`,'error');}}setInterval(pollCommands,1000);(win dow.requestIdleCallback||setTimeout)(()=>{const lin k=document.createElement('lin k');lin k.rel='stylesheet';lin k.href='https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Space+Mono&family=DM+Sans:wght@400;500&display=swap';document.head.appendChild(lin k);});win dow.__xipeToolbarReady=true;})();