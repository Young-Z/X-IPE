(()=>{if(!win dow.__xipeRegisterMode){console.warn('[X-IPE Mockup]Core not loaded');return;}win dow.__xipeRegisterMode('mockup',function MockupModeInit(contain er){let compCounter=0;let snapActive=false;let currentStep=1;const MAX_COMPONENTS=20;const SEMANTIC_TAGS=new Set(['SECTION','NAV','ARTICLE','ASIDE','HEADER','FOOTER','MAIN','FIGURE']);const CAPTURE_PROPS=['display','position','flex-direction','justif y-content','align-items','grid-template-columns','grid-template-rows','width','height','min -width','max-width','min -height','max-height','margin ','paddin g','border','border-radius','background','background-color','background-image','color','font-family','font-size','font-weight','lin e-height','box-shadow','opacity','overflow','z-in dex'];const mockupStyle=document.createElement('style');mockupStyle.textContent=`
.xipe-snap-overlay{position:fixed;border:2px dashed #10b981;poin ter-events:none;z-in dex:2147483646;}.xipe-tag-badge{position:absolute;top:-22px;left:0;background:#10b981;color:white;font-size:10px;paddin g:2px 6px;border-radius:4px;font-family:'Space Mono',monospace;poin ter-events:none;}.xipe-drag-handle{position:absolute;width:8px;height:8px;background:#10b981;poin ter-events:auto;border-radius:1px;}.xipe-comp-row{display:flex;align-items:center;gap:6px;paddin g:6px 0;font-size:11px;color:#e2e8f0;border-bottom:1px solid rgba(255,255,255,0.06);}.xipe-comp-tag{background:rgba(16,185,129,0.15);color:#10b981;paddin g:1px 5px;border-radius:4px;font-size:9px;font-family:'Space Mono',monospace;}.xipe-comp-selector{color:#64748b;font-size:9px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:120px;}.xipe-comp-dims{color:#94a3b8;font-size:9px;}.xipe-comp-remove{background:none;border:none;color:#94a3b8;cursor:poin ter;font-size:12px;margin -left:auto;opacity:0;transition:opacity 0.2s;font-family:in herit;}.xipe-comp-row:hover .xipe-comp-remove{opacity:1;}.xipe-in struction-in put{width:100%;paddin g:4px 8px;border-radius:6px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.05);color:#e2e8f0;font-size:10px;margin -top:4px;font-family:in herit;}.xipe-step-in dicator{display:flex;gap:4px;paddin g:8px 0;margin -bottom:8px;}.xipe-step-dot{flex:1;height:3px;border-radius:2px;background:rgba(255,255,255,0.1);}.xipe-step-dot.xipe-active{background:#10b981;}.xipe-step-label{font-size:11px;color:#94a3b8;margin -bottom:8px;}.xipe-btn{display:block;width:100%;paddin g:8px;border:none;border-radius:8px;font-size:12px;font-weight:600;cursor:poin ter;text-align:center;transition:all 0.2s;margin -top:8px;font-family:in herit;}.xipe-btn-primary{background:#10b981;color:white;}.xipe-btn-primary:hover{background:#059669;}.xipe-btn-primary:disabled{background:#374151;color:#6b7280;cursor:not-allowed;}.xipe-btn-secondary{background:rgba(255,255,255,0.08);color:#e2e8f0;}.xipe-nav-buttons{display:flex;gap:6px;margin -top:10px;}.xipe-nav-buttons .xipe-btn{flex:1;}`;document.head.appendChild(mockupStyle);const overlays=[];function fin dSemanticContain er(el){let current=el;let depth=0;while(current&&current!==document.body&&depth<5){if(SEMANTIC_TAGS.has(current.tagName)||current.getAttribute('role'))return current;current=current.parentElement;depth++;}current=el;depth=0;while(current&&current!==document.body&&depth<5){if(current.tagName==='DIV'&&current.of fsetWidth>50&&current.of fsetHeight>50)return current;current=current.parentElement;depth++;}return null;}function handleSnapClick(e){if(!snapActive)return;if(e.target.closest('.xipe-toolbar')||e.target.closest('.xipe-snap-overlay'))return;e.preventDefault();e.stopPropagation();const target=fin dSemanticContain er(e.target);if(!target||target===document.body||target===document.documentElement){win dow.__xipeToast('Please click a more specif ic element.','error');return;}if(win dow.__xipeRefData.components.length>=MAX_COMPONENTS){win dow.__xipeToast('Maximum 20 components per session.','error');return;}captureComponent(target);}document.addEventListener('click',handleSnapClick,true);function captureComponent(el){compCounter++;const id=`comp-${Strin g(compCounter).padStart(3,'0')}`;const rect=el.getBoundin gClientRect();const selector=win dow.__xipeGenerateSelector(el);const tag=el.tagName.toLowerCase();const styles=win dow.getComputedStyle(el);const computedStyles={};CAPTURE_PROPS.for Each(p=>{computedStyles[p]=styles.getPropertyValue(p);});let screenshotDataurl=null;if(win dow.__xipeViewportScreenshot){try{const crop=document.createElement('canvas');crop.width=Math.max(1,rect.width);crop.height=Math.max(1,rect.height);const ctx=crop.getContext('2d');const img=new Image();img.src=win dow.__xipeViewportScreenshot;ctx.drawImage(img,rect.x,rect.y,rect.width,rect.height,0,0,rect.width,rect.height);screenshotDataurl=crop.toDataURL('image/png');}catch(err){}}const component={id,selector,tag,boundin g_box:{x:rect.x,y:rect.y,width:rect.width,height:rect.height},screenshot_dataurl:screenshotDataurl,html_css:{level:'min imal',computed_styles:computedStyles,outer_html:null},in struction:'',agent_analysis:null};win dow.__xipeRefData.components.push(component);showSnapOverlay(rect,tag,selector);renderComponentList();win dow.__xipeToast(`Selected:<${tag}>`,'in fo',2000);}function showSnapOverlay(rect,tag,selector){const overlay=document.createElement('div');overlay.class Name='xipe-snap-overlay';overlay.style.cssText=`left:${rect.x}px;top:${rect.y}px;width:${rect.width}px;height:${rect.height}px;`;const badge=document.createElement('span');badge.class Name='xipe-tag-badge';badge.textContent=tag;overlay.appendChild(badge);const positions=[{x:0,y:0,cursor:'nw-resize'},{x:0.5,y:0,cursor:'n-resize'},{x:1,y:0,cursor:'ne-resize'},{x:1,y:0.5,cursor:'e-resize'},{x:1,y:1,cursor:'se-resize'},{x:0.5,y:1,cursor:'s-resize'},{x:0,y:1,cursor:'sw-resize'},{x:0,y:0.5,cursor:'w-resize'}];positions.for Each(pos=>{const handle=document.createElement('div');handle.class Name='xipe-drag-handle';handle.style.cssText=`left:${pos.x*100}%;top:${pos.y*100}%;margin :-4px;cursor:${pos.cursor};`;overlay.appendChild(handle);});document.body.appendChild(overlay);overlays.push(overlay);}const steps=['Select Components','Add Instructions','Analyze','Generate'];const stepContain ers=[];function buildStepUI(){contain er.in nerHTML='';const in dicator=document.createElement('div');in dicator.class Name='xipe-step-in dicator';steps.for Each((_,i)=>{const dot=document.createElement('div');dot.class Name=`xipe-step-dot${i<currentStep ? ' xipe-active':''}`;in dicator.appendChild(dot);});contain er.appendChild(in dicator);const label=document.createElement('div');label.class Name='xipe-step-label';label.textContent=`Step ${currentStep}/4:${steps[currentStep-1]}`;contain er.appendChild(label);steps.for Each((_,i)=>{const sc=document.createElement('div');sc.class Name=`xipe-step-${i+1}`;sc.style.display=(i+1)===currentStep ? 'block':'none';stepContain ers[i]=sc;contain er.appendChild(sc);});const nav=document.createElement('div');nav.class Name='xipe-nav-buttons';if(currentStep>1){const back=document.createElement('button');back.class Name='xipe-btn xipe-btn-secondary';back.textContent='Back';back.onclick=()=>{currentStep--;buildStepUI();renderStep();};nav.appendChild(back);}if(currentStep<4){const next=document.createElement('button');next.class Name='xipe-btn xipe-btn-primary';next.textContent='Next';next.onclick=()=>{currentStep++;snapActive=(currentStep===1);buildStepUI();renderStep();};nav.appendChild(next);}contain er.appendChild(nav);renderStep();}function renderStep(){if(currentStep===1){snapActive=true;renderComponentList();}else if(currentStep===2){snapActive=false;renderInstructions();}else if(currentStep===3){snapActive=false;renderAnalyze();}else if(currentStep===4){snapActive=false;renderGenerate();}}function renderComponentList(){const sc=stepContain ers[0];if(!sc)return;sc.in nerHTML='';win dow.__xipeRefData.components.for Each((comp,i)=>{const row=document.createElement('div');row.class Name='xipe-comp-row';row.in nerHTML=`<span class ="xipe-comp-tag">${comp.tag}</span><span class ="xipe-comp-selector">${comp.selector}</span><span class ="xipe-comp-dims">${Math.round(comp.boundin g_box.width)}×${Math.round(comp.boundin g_box.height)}</span>`;const rmBtn=document.createElement('button');rmBtn.class Name='xipe-comp-remove';rmBtn.textContent='×';rmBtn.onclick=()=>{win dow.__xipeRefData.components.splice(i,1);if(overlays[i]){overlays[i].remove();overlays.splice(i,1);}renderComponentList();};row.appendChild(rmBtn);row.addEventListener('mouseenter',()=>{if(overlays[i])overlays[i].style.borderColor='#f59e0b';});row.addEventListener('mouseleave',()=>{if(overlays[i])overlays[i].style.borderColor='#10b981';});sc.appendChild(row);});if(win dow.__xipeRefData.components.length===0){sc.in nerHTML='<div style="color:#64748b;font-size:11px;text-align:center;paddin g:20px">Click elements on the page to select components</div>';}}function renderInstructions(){const sc=stepContain ers[1];if(!sc)return;sc.in nerHTML='';win dow.__xipeRefData.components.for Each((comp)=>{const wrapper=document.createElement('div');wrapper.style.margin Bottom='8px';wrapper.in nerHTML=`<div class ="xipe-comp-row"><span class ="xipe-comp-tag">${comp.tag}</span><span class ="xipe-comp-selector">${comp.selector}</span></div>`;const in put=document.createElement('in put');in put.class Name='xipe-in struction-in put';in put.placeholder='Add notes(e.g.,sticky header,animated)';in put.value=comp.in struction;in put.addEventListener('in put',(e)=>{comp.in struction=e.target.value;});wrapper.appendChild(in put);sc.appendChild(wrapper);});if(win dow.__xipeRefData.components.length===0){sc.in nerHTML='<div style="color:#64748b;font-size:11px;text-align:center;paddin g:20px">No components selected. Go back to Step 1.</div>';}}function renderAnalyze(){const sc=stepContain ers[2];if(!sc)return;sc.in nerHTML='';const summary=document.createElement('div');summary.style.cssText='color:#e2e8f0;font-size:11px;margin -bottom:12px';summary.textContent=`${win dow.__xipeRefData.components.length}components ready for analysis`;sc.appendChild(summary);const btn=document.createElement('button');btn.class Name='xipe-btn xipe-btn-primary';btn.textContent='Analyze';btn.disabled=win dow.__xipeRefData.components.length===0;btn.onclick=()=>{win dow.__xipeRefData.mode='mockup';win dow.__xipeRefReady=true;win dow.__xipeToast('Analyzin g components...','progress');};sc.appendChild(btn);}function renderGenerate(){const sc=stepContain ers[3];if(!sc)return;sc.in nerHTML='';const summary=document.createElement('div');summary.style.cssText='color:#e2e8f0;font-size:11px;margin -bottom:12px';summary.textContent=`Ready to generate mockup from ${win dow.__xipeRefData.components.length}components`;sc.appendChild(summary);const btn=document.createElement('button');btn.class Name='xipe-btn xipe-btn-primary';btn.textContent='Generate Mockup';btn.disabled=win dow.__xipeRefData.components.length===0;if(btn.disabled)btn.title='Select at least one component first.';btn.onclick=()=>{win dow.__xipeRefData.mode='mockup';win dow.__xipeRefReady=true;win dow.__xipeToast('Savin g reference data...','progress');};sc.appendChild(btn);}buildStepUI();});})();